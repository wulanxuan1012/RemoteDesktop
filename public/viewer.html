<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è¿œç¨‹æ¡Œé¢æ§åˆ¶ - V2.2</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* WebRTC ä¸“ç”¨æ ·å¼ */
        #remote-video {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            background: #000;
            display: block;
        }

        #screen-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
            z-index: 1;
        }

        #status-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 30px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            display: flex;
            align-items: center;
            padding: 0 10px;
            z-index: 10;
            font-size: 12px;
            pointer-events: none;
        }

        #debug-panel {
            position: fixed;
            top: 35px;
            left: 5px;
            width: 200px;
            max-height: 300px;
            background: rgba(0, 0, 0, 0.7);
            color: #0f0;
            font-family: monospace;
            font-size: 10px;
            overflow-y: auto;
            border: 1px solid #333;
            padding: 5px;
            z-index: 100;
            pointer-events: auto;
            /* å…è®¸äº¤äº’ */
            display: none;
        }

        #debug-panel.visible {
            display: block;
        }

        #play-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
        }

        #play-overlay.hidden {
            display: none;
        }

        .play-btn {
            font-size: 48px;
            margin-bottom: 20px;
        }

        #toolbar {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 20;
            display: flex;
            gap: 10px;
        }

        .tool-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 24px;
            backdrop-filter: blur(5px);
            cursor: pointer;
        }

        .tool-btn:active {
            background: rgba(255, 255, 255, 0.4);
        }

        /* Virtual Keyboard */
        #virtual-keyboard {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            padding: 10px;
            z-index: 50;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        #virtual-keyboard.hidden {
            display: none;
        }

        .keyboard-row {
            display: flex;
            gap: 5px;
            justify-content: center;
        }

        .key-btn {
            flex: 1;
            padding: 10px;
            border-radius: 5px;
            background: #333;
            color: white;
            border: none;
        }

        .key-btn:active,
        .key-btn.active {
            background: #666;
        }

        #text-input {
            flex: 2;
            padding: 10px;
            border-radius: 5px;
            border: none;
        }

        #btn-send-text {
            flex: 1;
            border-radius: 5px;
            border: none;
            background: #2ed573;
            color: white;
        }

        /* ç™»å‡ºæŒ‰é’® */
        #btn-logout {
            background: #ff4757 !important;
        }

        #btn-logout:hover {
            background: #ff6b7a !important;
        }
    </style>
</head>

<body>
    <div id="status-bar">
        <span id="status-dot"
            style="width:8px;height:8px;border-radius:50%;background:red;margin-right:5px;display:inline-block;"></span>
        <span id="status-text">åˆå§‹åŒ–...</span>
        <span id="fps-counter" style="margin-left:auto;">-- FPS</span>
    </div>

    <!-- è°ƒè¯•é¢æ¿ -->
    <div id="debug-panel"></div>

    <div id="screen-container">
        <video id="remote-video" autoplay playsinline webkit-playsinline muted></video>
    </div>

    <!-- ç‚¹å‡»æ’­æ”¾é®ç½© -->
    <div id="play-overlay" class="hidden">
        <div class="play-btn">â–¶ï¸</div>
        <div id="play-msg">ç‚¹å‡»å¼€å§‹æ˜¾ç¤ºç”»é¢</div>
        <div style="margin-top:10px;font-size:12px;color:#aaa;" id="play-debug-info"></div>
    </div>

    <div id="toolbar" style="z-index: 200;">
        <button id="btn-debug" class="tool-btn" style="font-size:16px">ğŸ</button>
        <button id="btn-keyboard" class="tool-btn">âŒ¨ï¸</button>
        <button id="btn-fullscreen" class="tool-btn">â›¶</button>
        <button id="btn-logout" class="tool-btn" title="ç™»å‡º">ğŸšª</button>
    </div>

    <div id="virtual-keyboard" class="hidden">
        <div class="keyboard-row">
            <input type="text" id="text-input" placeholder="è¾“å…¥æ–‡æœ¬">
            <button id="btn-send-text">å‘é€</button>
        </div>
        <div class="keyboard-row">
            <button class="key-btn" data-key="escape">Esc</button>
            <button class="key-btn" data-key="tab">Tab</button>
            <button class="key-btn" data-key="backspace">âŒ«</button>
            <button class="key-btn" data-key="enter">Enter</button>
        </div>
        <div class="keyboard-row">
            <button class="key-btn modifier" data-key="control">Ctrl</button>
            <button class="key-btn modifier" data-key="alt">Alt</button>
            <button class="key-btn modifier" data-key="shift">Shift</button>
            <button class="key-btn" data-key="space">Space</button>
        </div>
    </div>

    <!-- å¼•ç”¨å¤–éƒ¨ JSï¼Œä½¿ç”¨æ—¶é—´æˆ³é¿å…ç¼“å­˜ -->
    <script src="client-webrtc.js?v=2.4"></script>
    <script>
        // ç™»å‡ºåŠŸèƒ½
        const btnLogout = document.getElementById('btn-logout');
        if (btnLogout) {
            const handleLogout = async (e) => {
                console.log('ğŸ”´ ç™»å‡ºæŒ‰é’®è¢«ç‚¹å‡»', e.type);

                // é˜²æ­¢å¤šæ¬¡è§¦å‘ï¼ˆç§»åŠ¨ç«¯ touch + clickï¼‰
                e.preventDefault();
                e.stopPropagation();

                if (confirm('ç¡®å®šè¦ç™»å‡ºå—ï¼Ÿ')) {
                    console.log('ç”¨æˆ·ç¡®è®¤ç™»å‡º...');
                    try {
                        await fetch('/api/auth/logout', { method: 'POST' });
                    } catch (e) { console.error(e); }

                    document.cookie = 'auth_token=; path=/; max-age=0';
                    window.location.href = '/login.html';
                }
            };

            // åŒæ—¶ç›‘å¬ touch å’Œ click ä»¥å…¼å®¹ç§»åŠ¨ç«¯
            btnLogout.addEventListener('touchend', handleLogout);
            btnLogout.addEventListener('click', handleLogout);
        }
    </script>
</body>

</html>